<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>hserus5</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{margin:0;background:#07121a;color:#e6f3f6;font-family:Arial;padding:16px}
h1{font-size:18px;margin:0}
.controls{display:flex;gap:10px;align-items:center;margin-top:8px}
button{padding:8px 14px;border:none;border-radius:6px;background:#7be3c7;color:#022;cursor:pointer}
button:disabled{opacity:.5}
.small{font-size:13px;color:#9fb6c7}
#bar{height:10px;background:#122;border-radius:6px;overflow:hidden;margin-top:12px}
#fill{height:100%;width:0%;background:linear-gradient(90deg,#7be3c7,#2bd18a)}
table{width:100%;border-collapse:collapse;margin-top:14px;background:#0b2230}
th,td{padding:9px;border-bottom:1px solid #123;text-align:right}
th{cursor:pointer;color:#9fb6c7}
td.symbol{text-align:left;color:#7bdfff;font-weight:bold}
.green{color:#7be3c7}
.red{color:#ff6b6b}
</style>
</head>
<body>

<h1>hserus5</h1>

<div class="controls">
  <button id="refresh">Refresh</button>
  <div id="status" class="small">Idle</div>
</div>

<div id="bar"><div id="fill"></div></div>

<table>
<thead>
<tr>
  <th>Symbol</th>
  <th>Close%</th>
  <th>Vol%</th>
  <th>Max%</th>
  <th>Body%</th>
</tr>
</thead>
<tbody id="body">
<tr><td colspan="5" class="small">Click Refresh</td></tr>
</tbody>
</table>

<script>
const BASE = 'https://fapi.binance.com';
const BATCH = 5;
const MAX = 250;

const EXCLUDE = new Set([
"BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","ADAUSDT","DOGEUSDT","AVAXUSDT",
"DOTUSDT","TRXUSDT","LINKUSDT","LTCUSDT","BCHUSDT","ATOMUSDT","FILUSDT","APTUSDT","SUIUSDT"
]);

const bodyEl = document.getElementById('body');
const fill = document.getElementById('fill');
const status = document.getElementById('status');
const btn = document.getElementById('refresh');

const pct = (a,b)=>((a-b)/b)*100;
const color = (o,c)=>c>o?'green':c<o?'red':'doji';

async function j(u){const r=await fetch(u);if(!r.ok)throw 0;return r.json();}

async function symbols(){
  const [ei,t] = await Promise.all([
    j(BASE+'/exchangeInfo'),
    j(BASE+'/ticker/24hr')
  ]);
  const perp = new Set(
    ei.symbols.filter(s=>s.contractType==='PERPETUAL' && s.symbol.endsWith('USDT')).map(s=>s.symbol)
  );
  return t
    .filter(x=>perp.has(x.symbol) && !EXCLUDE.has(x.symbol))
    .map(x=>({s:x.symbol,score:Math.abs(x.priceChangePercent)*x.quoteVolume}))
    .sort((a,b)=>b.score-a.score)
    .slice(0,MAX)
    .map(x=>x.s);
}

async function klines(s){return j(`${BASE}/klines?symbol=${s}&interval=1h&limit=3`);}

async function scan(){
  btn.disabled=true;
  bodyEl.innerHTML='';
  fill.style.width='0%';
  status.textContent='Fetching symbolsâ€¦';

  const syms = await symbols();
  let done=0;

  for(let i=0;i<syms.length;i+=BATCH){
    const batch = syms.slice(i,i+BATCH);

    const res = await Promise.all(batch.map(async s=>{
      try{
        const k = await klines(s);
        const p2=k[0], p1=k[1], c=k[2];

        if(color(c[1],c[4])!==color(p1[1],p1[4])) return;
        if(+p1[5] <= +p2[5]) return;
        if(+c[5] <= +p1[5]*0.6) return;

        const o=+c[1], h=+c[2], l=+c[3], cl=+c[4];
        const body=Math.abs(cl-o);
        const uw=h-Math.max(o,cl);
        const lw=Math.min(o,cl)-l;

        if(cl>o){
          if(lw<=uw || body<=lw*0.8) return;
        }else{
          if(uw<=lw || body<=uw*0.8) return;
        }

        const cp=pct(cl,o);
        const pp=pct(+p1[4],+p1[1]);
        const vp=pct(+c[5],+p1[5]);
        const wick = cl>o?lw:uw;

        return {s,cp,vp,mp:Math.max(Math.abs(cp),Math.abs(pp)),bp:(body/wick)*100};
      }catch{return;}
    }));

    res.filter(Boolean).forEach(o=>{
      const tr=document.createElement('tr');
      tr.innerHTML=`
        <td class="symbol">${o.s}</td>
        <td class="${o.cp>=0?'green':'red'}">${o.cp.toFixed(2)}%</td>
        <td>${o.vp.toFixed(2)}%</td>
        <td>${o.mp.toFixed(2)}%</td>
        <td>${o.bp.toFixed(0)}%</td>`;
      bodyEl.appendChild(tr);
    });

    done+=batch.length;
    fill.style.width=(done/syms.length*100)+'%';
    status.textContent=`Scanning ${done}/${syms.length}`;
    await new Promise(r=>setTimeout(r,120));
  }

  status.textContent='Scan complete';
  btn.disabled=false;
}

btn.onclick=scan;

/* sorting */
document.querySelectorAll('th').forEach((th,i)=>{
  th.onclick=()=>{
    const rows=[...bodyEl.rows];
    const asc=th.asc=!th.asc;
    rows.sort((a,b)=>{
      const x=parseFloat(a.cells[i].innerText)||0;
      const y=parseFloat(b.cells[i].innerText)||0;
      return asc?x-y:y-x;
    });
    rows.forEach(r=>bodyEl.appendChild(r));
  };
});
</script>
</body>
</html>
