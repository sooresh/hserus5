<!DOCTYPE html>
<html>
<head>
  <title>hserus5</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    button { padding: 8px 16px; margin-bottom: 10px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; border: 1px solid #ccc; text-align: center; }
    th { cursor: pointer; background: #f2f2f2; }
    #progress { margin-top: 10px; font-weight: bold; }
  </style>
</head>
<body>

<h2>hserus5</h2>
<button onclick="scanData()">Refresh</button>
<div id="progress"></div>

<table id="scannerTable">
  <thead>
    <tr>
      <th onclick="sortTable(0)">Symbol</th>
      <th onclick="sortTable(1)">Hourly Close %</th>
      <th onclick="sortTable(2)">Hourly Vol %</th>
      <th onclick="sortTable(3)">Funding</th>
      <th onclick="sortTable(4)">Î” Funding %</th>
      <th onclick="sortTable(5)">Close Since Cycle %</th>
      <th onclick="sortTable(6)">Cycle</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function scanData() {
  const tableBody = document.querySelector("#scannerTable tbody");
  tableBody.innerHTML = "";
  const progress = document.getElementById("progress");

  // Example list of symbols (replace with API call)
  const symbols = ["BTCUSDT", "ETHUSDT", "BNBUSDT"]; 
  let i = 0;

  for (const symbol of symbols) {
    i++;
    progress.textContent = `Scanning ${i} of ${symbols.length}...`;

    // Replace with real API calls:
    const hourlyCloseChange = (Math.random()*4-2).toFixed(2);
    const hourlyVolChange = (Math.random()*20-10).toFixed(2);
    const currFunding = (Math.random()*0.02-0.01).toFixed(4);
    const prevFunding = (Math.random()*0.02-0.01).toFixed(4);
    const fundingDiff = (((currFunding - prevFunding) / Math.abs(prevFunding || 1)) * 100).toFixed(2);
    const closeSinceCycle = (Math.random()*10-5).toFixed(2);
    const cycle = ["4h","8h"][Math.floor(Math.random()*2)];

    const row = `<tr>
      <td>${symbol}</td>
      <td>${hourlyCloseChange}%</td>
      <td>${hourlyVolChange}%</td>
      <td>${currFunding}</td>
      <td>${fundingDiff}%</td>
      <td>${closeSinceCycle}%</td>
      <td>${cycle}</td>
    </tr>`;
    tableBody.innerHTML += row;
  }
  progress.textContent = "Done";
}

// Simple sort
function sortTable(n) {
  const table = document.getElementById("scannerTable");
  let switching = true, dir = "asc", switchcount = 0;
  while (switching) {
    switching = false;
    const rows = table.rows;
    for (let i = 1; i < rows.length-1; i++) {
      let shouldSwitch = false;
      let x = rows[i].getElementsByTagName("TD")[n];
      let y = rows[i+1].getElementsByTagName("TD")[n];
      let cmpX = parseFloat(x.innerHTML) || x.innerHTML.toLowerCase();
      let cmpY = parseFloat(y.innerHTML) || y.innerHTML.toLowerCase();
      if ((dir=="asc" && cmpX > cmpY) || (dir=="desc" && cmpX < cmpY)) {
        shouldSwitch = true; break;
      }
    }
    if (shouldSwitch) {
      rows[i].parentNode.insertBefore(rows[i+1], rows[i]);
      switching = true; switchcount++;
    } else {
      if (switchcount == 0 && dir == "asc") { dir = "desc"; switching = true; }
    }
  }
}
</script>

</body>
</html>
