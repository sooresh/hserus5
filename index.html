<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>hserus5</title>
<style>
  body { font-family: Arial, sans-serif; background: #0b0b0b; color: #e6e6e6; text-align: center; }
  h2 { color: #00e676; }
  button { background: #00e676; color: #000; border: none; padding: 10px 20px; margin: 10px; border-radius: 5px; cursor: pointer; font-weight: bold; }
  button:hover { background: #00c853; }
  #progress { margin: 10px; color: #ffeb3b; }
  table { width: 95%; margin: 20px auto; border-collapse: collapse; background: #121212; }
  th, td { padding: 10px; border: 1px solid #333; }
  th { background: #1c1c1c; cursor: pointer; }
  tr:nth-child(even) { background: #181818; }
</style>
</head>
<body>

<h2>hserus5</h2>
<button onclick="fetchScanner()">ðŸ”„ Refresh</button>
<div id="progress"></div>
<table id="resultTable">
  <thead>
    <tr>
      <th onclick="sortTable(0)">Symbol</th>
      <th onclick="sortTable(1)">Close%</th>
      <th onclick="sortTable(2)">Buy/Sell</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let sortDirection = [true, true, true];

async function fetchScanner() {
  const progress = document.getElementById('progress');
  const tbody = document.querySelector('#resultTable tbody');
  tbody.innerHTML = "";
  progress.textContent = "â³ Fetching top symbols...";

  try {
    // Step 1: Get top 250 USDT Perpetual symbols
    const exInfo = await fetch("https://fapi.binance.com/fapi/v1/exchangeInfo").then(r => r.json());
    let symbols = exInfo.symbols
      .filter(s => s.symbol.endsWith("USDT") && s.contractType === "PERPETUAL")
      .map(s => s.symbol)
      .filter(s => !["BTCUSDT","ETHUSDT","BNBUSDT","SOLUSDT","XRPUSDT","DOGEUSDT","ADAUSDT","AVAXUSDT","DOTUSDT","LINKUSDT",
                     "TRXUSDT","MATICUSDT","TONUSDT","LTCUSDT","BCHUSDT","SHIBUSDT","UNIUSDT","ETCUSDT","ICPUSDT","APTUSDT"]
                     .includes(s))
      .slice(0, 250);

    progress.textContent = `ðŸ“Š Scanning ${symbols.length} symbols...`;

    let results = [];

    // Step 2: Loop through symbols
    for (let i = 0; i < symbols.length; i++) {
      const sym = symbols[i];
      progress.textContent = `ðŸ” Processing ${sym} (${i+1}/${symbols.length})`;

      try {
        const data = await fetch(`https://fapi.binance.com/fapi/v1/klines?symbol=${sym}&interval=1h&limit=3`).then(r => r.json());
        if (!Array.isArray(data) || data.length < 3) continue;
        const prev = data[data.length - 2];
        const curr = data[data.length - 1];

        const open = parseFloat(curr[1]);
        const high = parseFloat(curr[2]);
        const low = parseFloat(curr[3]);
        const close = parseFloat(curr[4]);
        const vol = parseFloat(curr[5]);
        const prevVol = parseFloat(prev[5]);
        const closeChange = ((close - open) / open) * 100;

        const buyVol = ((close - low) / (high - low || 1)) * vol;
        const sellVol = ((high - close) / (high - low || 1)) * vol;
        const ratio = sellVol > 0 ? (buyVol / sellVol).toFixed(2) : "âˆž";

        // Condition: if green, sellVol > buyVol; if red, buyVol > sellVol
        const isGreen = close > open;
        if ((isGreen && sellVol > buyVol) || (!isGreen && buyVol > sellVol)) {
          results.push({
            symbol: sym,
            closePct: closeChange.toFixed(2),
            ratio
          });
        }

      } catch (err) {
        console.warn(`Error fetching ${sym}`, err);
      }
    }

    // Step 3: Show results
    tbody.innerHTML = results.map(r =>
      `<tr>
        <td>${r.symbol}</td>
        <td>${r.closePct}%</td>
        <td>${r.ratio}</td>
      </tr>`
    ).join("");

    progress.textContent = `âœ… Scan complete. ${results.length} results found.`;

  } catch (error) {
    progress.textContent = "âŒ Error fetching data. Please refresh.";
    console.error(error);
  }
}

// Sorting
function sortTable(n) {
  const table = document.getElementById("resultTable");
  const tbody = table.tBodies[0];
  const rows = Array.from(tbody.rows);
  const asc = sortDirection[n];
  rows.sort((a, b) => {
    let x = a.cells[n].innerText.replace('%','');
    let y = b.cells[n].innerText.replace('%','');
    let nx = parseFloat(x) || x.toLowerCase();
    let ny = parseFloat(y) || y.toLowerCase();
    return asc ? nx > ny ? 1 : -1 : nx < ny ? 1 : -1;
  });
  rows.forEach(row => tbody.appendChild(row));
  sortDirection[n] = !asc;
}

fetchScanner();
</script>

</body>
</html>
